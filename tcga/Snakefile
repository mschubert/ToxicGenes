types = [ "naive", "pur", "puradj" ]
tissues = ["pan", "BRCA", "LUAD", "LUSC", "HNSC", "KIRC", "SKCM", "COAD", "OV"]

mem = {
    "pan" : 61440,
    "BRCA" : 10240,
    "*" : 4096
}

rule all:
    input:
        expand("{type}/{tissue}.pdf", tissue=tissues, type=types)

rule do_fit:
    input:
        rscript = "tcga_genes.r"
    output:
        outfile = "{type}/{tissue}.xlsx"
    resources:
        mem = lambda wc: mem[wc.tissue] if wc.tissue in mem.keys() else mem["*"],
        walltime = 120,
        cores = 10
    shell:
        "Rscript {input.rscript}"
            " --tissue {wildcards.tissue}"
            " --type {wildcards.type}"
            " --cores {resources.cores}"
            " --memory {resources.mem}"
            " --outfile {output.outfile}"

rule plot:
    input:
        rscript = "plot.r",
        infile = "{type}/{tissue}.xlsx"
    output:
        plotfile = "{type}/{tissue}.pdf"
    shell:
        "Rscript {input.rscript}"
            " --infile {input.infile}"
            " --plotfile {output.plotfile}"
